<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>AT&amp;T M2X C Library: C M2X API Client</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">AT&amp;T M2X C Library
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">C M2X API Client </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a href="http://m2x.att.com">AT&amp;T M2X</a> is a cloud-based fully managed time-series data storage service for network connected machine-to-machine (M2M) devices and the Internet of Things (IoT).</p>
<p>The <a href="https://m2x.att.com/developer/documentation/overview">AT&amp;T M2X API</a> provides all the needed operations and methods to connect your devices to AT&amp;T's M2X service. This library aims to provide a simple wrapper to interact with the AT&amp;T M2X API for <a href="http://www.open-std.org/jtc1/sc22/wg14/">C</a>. Refer to the <a href="https://m2x.att.com/developer/documentation/glossary">Glossary of Terms</a> to understand the nomenclature used throughout this documentation.</p>
<h1>Getting Started </h1>
<ol type="1">
<li>Signup for an M2X Account: <a href="https://m2x.att.com/signup">https://m2x.att.com/signup</a></li>
<li>Obtain your <em>Master Key</em> from the Master Keys tab of your Account Settings: <a href="https://m2x.att.com/account">https://m2x.att.com/account</a></li>
<li>Create your first Device and copy its <em>Device ID</em>: <a href="https://m2x.att.com/devices">https://m2x.att.com/devices</a></li>
<li>Review the M2X API Documentation: <a href="https://m2x.att.com/developer/documentation/overview">https://m2x.att.com/developer/documentation/overview</a></li>
</ol>
<p>If you have questions about any M2X specific terms, please consult the M2X glossary: <a href="https://m2x.att.com/developer/documentation/glossary">https://m2x.att.com/developer/documentation/glossary</a></p>
<h1>Setup </h1>
<p>The library is written in <a href="http://en.wikipedia.org/wiki/ANSI_C">C89</a> standard. So you can use most C compilers, including gcc and clang, to compile the source code. The only external dependency is <a href="http://curl.haxx.se/libcurl/">libcurl</a> (please refer to the documentation for your OS for instructions on how to install libcurl). In fact, most Linux distributions come with libcurl support natively.</p>
<p>To build the m2x-c library, follow the next steps:</p>
<div class="fragment"><div class="line">$ git clone https://github.com/attm2x/m2x-c.git</div><div class="line">$ cd m2x-c</div><div class="line">$ git submodule update --init</div><div class="line">$ make</div></div><!-- fragment --><p>If no errors occur, the M2X library will be in the <code>m2x-c/m2x.a</code> file. Feel free to link and use the m2x library in your own executables.</p>
<h1>Examples </h1>
<p>After setting up the M2X client, to run one of our <a href="/examples">examples</a> proceed with the following steps:</p>
<ol type="1">
<li>Once you've selected an example to run, open the file and add your user specific information such as your <code>API Key</code>, <code>Device ID</code>, etc.</li>
<li><p class="startli">Build the examples by running the following command in the root directory of the m2x-c client library:</p>
<p class="startli">``` $ make examples ```</p>
</li>
<li><p class="startli">To run an example, execute the following command from within the <code>m2x-c/examples</code> directory:</p>
<p class="startli">``` $ ./example_filename ```</p>
</li>
</ol>
<h1>API </h1>
<h2>Initialization</h2>
<p>To use the M2X C library, you need to first create an M2X context using the following function:</p>
<div class="fragment"><div class="line">m2x_context *m2x_open(const char *key);</div></div><!-- fragment --><p>This function resides in <code><a class="el" href="m2x_8h.html" title="Wrapper for AT&amp;T M2X API ">m2x.h</a></code> header file. The only argument to this function is your M2X API key, which you can obtain from the <a href="https://m2x.att.com">M2X website</a>.</p>
<h2>Calling API functions</h2>
<p>All API functions will have the following type of signature:</p>
<div class="fragment"><div class="line">m2x_response m2x_some_api_function(m2x_context *ctx, const char *arg1, const char *arg2, ...);</div></div><!-- fragment --><p>Depending the exact function in use, different number of arguments may be present. For example, below is a function used to list stream values of a device:</p>
<div class="fragment"><div class="line">m2x_response m2x_device_stream_list_values(m2x_context *ctx, const char *id, const char *name, const char *query);</div></div><!-- fragment --><p>It requires the context object, device ID, stream name and a query string. The query string is the same you would normally see in an HTTP request, like the following:</p>
<div class="fragment"><div class="line">max=100&amp;limit=10</div></div><!-- fragment --><p>We will talk about <code><a class="el" href="structm2x__response.html">m2x_response</a></code> in the next section.</p>
<h2>Response object</h2>
<p>All API functions will return an <code><a class="el" href="structm2x__response.html">m2x_response</a></code> object. This object contains the status code, raw response as well as JSON-parsed response. The type of this object is as follows:</p>
<div class="fragment"><div class="line">typedef struct m2x_response {</div><div class="line">  int status;</div><div class="line">  /* Raw response from server */</div><div class="line">  char *raw;</div><div class="line">  /* Parsed JSON representation */</div><div class="line">  JSON_Value *json;</div><div class="line">} m2x_response;</div></div><!-- fragment --><ul>
<li><code>status</code> contains the same status code as those you can see in an HTTP request</li>
<li><code>raw</code> contains the raw reply from the API server (not necessarily NULL-terminated)</li>
<li><code>data</code> contains the reply in JSON format</li>
</ul>
<p>The library for parsing JSON we use here is <a href="https://github.com/kgabis/parson">parson</a>. However, with the help of <code>raw</code> field, you can parse the response using any JSON parser you like. The <code>expand_json</code> member of the <code>m2x_content</code> object defaults to 1, which indicates that parson <em>will</em> be used to parse JSON reply. If you change this field to 0, parson <em>will not</em> be used to parse the raw reply, allowing you to use your own parsing code/library.</p>
<p>A handful of helpers are created for better usage of this object:</p>
<div class="fragment"><div class="line">int m2x_is_success(const m2x_response *response);</div><div class="line">int m2x_is_client_error(const m2x_response *response);</div><div class="line">int m2x_is_server_error(const m2x_response *response);</div><div class="line">int m2x_is_error(const m2x_response *response);</div><div class="line">void m2x_release_response(m2x_response *response);</div></div><!-- fragment --><p>Notice <code>m2x_release_response</code> only frees the internal <code>raw</code> and <code>json</code> fields. There's no need to free any <code><a class="el" href="structm2x__response.html">m2x_response</a></code> object, since it is always passed by value.</p>
<h2>Writer functions</h2>
<p>You can also send data to M2X service using the C library. The following function can be used to update stream values:</p>
<div class="fragment"><div class="line">m2x_response m2x_device_stream_post_values(m2x_context *ctx, const char *device_id,</div><div class="line">                                           const char *stream_name, const char *data);</div></div><!-- fragment --><p><code>device_id</code> and <code>stream_name</code> are just the plain text Device ID and Stream that you are writing to. Notice that the C library will help you encode the data here, so if your Stream name has a space in it (for example, <code>my stream 1</code>), there's no need to escape that before calling this function.</p>
<p>You can pass the data you want to send to M2X using the <code>data</code> parameter here. For now, the M2X C library only supports JSON string format. You need to either create the JSON string by hand (like in the provided examples), or use a <a href="http://www.json.org/">JSON builder</a> to create one. In addition, we also provide a JSON serializer that you can use to build such a JSON string.</p>
<h2>JSON Serializer</h2>
<p>In the M2X C library, we provide a JSON serializer implementation to help you build JSON strings that you can use in writer functions. With the JSON serializer, you can easily build a JSON array or object containing arbitrary levels of (nested) data structure. All data types in JSON (null, boolean, number and string) are supported. Please refer to <a href="https://github.com/attm2x/m2x-c/blob/master/examples/serialize_json.c">serialize_json</a> for an example of how to use the library.</p>
<p>It's worth mentioning that since floating point numbers (such as double) may contain as many as several hundred bytes, we don't yet have a native function for packing arbitrary double values in the JSON serializer. If you really do want to use double, you can specify your own precision level, use <code>sprintf</code> to keep it in a char buffer and then use <code>json_pack_value</code> to pack the data.</p>
<h2>Verbose mode</h2>
<p>To help in debugging M2X API functions, the M2X C library supports a verbose mode. You can use the following code to turn it on:</p>
<div class="fragment"><div class="line">m2x_set_verbose(ctx, 1);</div></div><!-- fragment --><p>When verbose mode is on, the M2X C library will print debugging information from libcurl to <code>stdout</code>. An example of the output looks like this:</p>
<div class="fragment"><div class="line">* Hostname was NOT found in DNS cache</div><div class="line">*   Trying 76.198.15.58...</div><div class="line">* Connected to api-m2x.att.com (76.198.15.58) port 80 (#0)</div><div class="line">&gt; POST /v2/devices HTTP/1.1</div><div class="line">Host: api-m2x.att.com</div><div class="line">Accept: */*</div><div class="line">User-Agent: M2X/2.0.0 (C libcurl)</div><div class="line">Content-Type: application/json</div><div class="line">X-M2X-KEY: b3e742805ac8576d0df925b4dfe4d401</div><div class="line">Content-Length: 115</div><div class="line"></div><div class="line">* upload completely sent off: 115 out of 115 bytes</div><div class="line">&lt; HTTP/1.1 201 Created</div><div class="line">* Server nginx is not blacklisted</div><div class="line">&lt; Server: nginx</div><div class="line">&lt; Date: Sat, 20 Dec 2014 06:08:21 GMT</div><div class="line">&lt; Content-Type: application/json</div><div class="line">&lt; Content-Length: 451</div><div class="line">&lt; Status: 201 Created</div><div class="line">&lt; Location: http://api-m2x.att.com/v2/devices/0920125bea7fa9e42484faf86c75496e</div><div class="line">&lt; X-M2X-VERSION: v2.4.0-alpha</div><div class="line">&lt; Vary: Accept-Encoding</div><div class="line">&lt;</div><div class="line">* Connection #0 to host api-m2x.att.com left intact</div><div class="line">Status code: 201</div><div class="line">{&quot;url&quot;:&quot;http://api-m2x.att.com/v2/devices/0920125bea7fa9e42484faf86c75496e&quot;,&quot;name&quot;:&quot;Sample Device&quot;,&quot;status&quot;:&quot;enabled&quot;,&quot;serial&quot;:null,&quot;tags&quot;:[&quot;sample&quot;],&quot;location&quot;:{},&quot;visibility&quot;:&quot;public&quot;,&quot;description&quot;:&quot;This is a sample M2X Device&quot;,&quot;created&quot;:&quot;2014-12-20T06:08:21.752Z&quot;,&quot;updated&quot;:&quot;2014-12-20T06:08:21.752Z&quot;,&quot;id&quot;:&quot;0920125bea7fa9e42484faf86c75496e&quot;,&quot;streams&quot;:{&quot;count&quot;:0,&quot;url&quot;:&quot;http://api-m2x.att.com/v2/devices/0920125bea7fa9e42484faf86c75496e/streams&quot;}}</div></div><!-- fragment --><p>To turn the verbose mode off, use the following code:</p>
<div class="fragment"><div class="line">m2x_set_verbose(ctx, 0);</div></div><!-- fragment --><h2>License</h2>
<p>The M2X C Client is available under the MIT license. See the LICENSE file for more information. </p>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
